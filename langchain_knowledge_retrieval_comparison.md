# LangChain å·¥ç¨‹ä¸­ä¸¤ç§çŸ¥è¯†æ£€ç´¢å®ç°æ–¹å¼å¯¹æ¯”

## ğŸ“‹ æ¦‚è¿°

LangChain å·¥ç¨‹ä¸­å®ç°äº†ä¸¤ç§ä¸åŒçš„çŸ¥è¯†æ£€ç´¢æ–¹å¼ï¼Œåˆ†åˆ«é’ˆå¯¹ä¸åŒçš„ä½¿ç”¨åœºæ™¯å’Œéœ€æ±‚ã€‚æœ¬æ–‡æ¡£è¯¦ç»†å¯¹æ¯”è¿™ä¸¤ç§å®ç°æ–¹å¼çš„æŠ€æœ¯æ¶æ„ã€åŠŸèƒ½ç‰¹æ€§ã€ä¼˜ç¼ºç‚¹ç­‰ã€‚

## ğŸ” 1. åŸºç¡€çŸ¥è¯†æ£€ç´¢æœåŠ¡ (KnowledgeSearchService)

### 1.1 å®ç°æ–¹å¼

- **å‘é‡å­˜å‚¨**ï¼šè‡ªç ”çš„ FAISS å‘é‡å­˜å‚¨ (`FaissVectorStore`)
- **å‘é‡åŒ–**ï¼šä½¿ç”¨ `VectorizationService` + AllMiniLmL6V2 æ¨¡å‹
- **æ£€ç´¢ç®—æ³•**ï¼šåŸºäºä½™å¼¦ç›¸ä¼¼åº¦çš„å‘é‡æ£€ç´¢
- **å­˜å‚¨æ–¹å¼**ï¼šå†…å­˜å­˜å‚¨ + æ–‡ä»¶æŒä¹…åŒ–

### 1.2 æ ¸å¿ƒåŠŸèƒ½

```java
// ä¸»è¦æ–¹æ³•
public KnowledgeSearchResponse searchKnowledge(KnowledgeSearchRequest request)
```

### 1.3 æŠ€æœ¯æ ˆ

- **å‘é‡åŒ–æ¨¡å‹**ï¼šAllMiniLmL6V2 (384 ç»´)
- **å‘é‡å­˜å‚¨**ï¼šå†…å­˜ Map + æ–‡ä»¶æŒä¹…åŒ–
- **ç›¸ä¼¼åº¦è®¡ç®—**ï¼šä½™å¼¦ç›¸ä¼¼åº¦
- **è¿‡æ»¤æœºåˆ¶**ï¼šå†…å®¹ç±»å‹ã€å¤„ç†çŠ¶æ€ç­‰

### 1.4 ä¼˜ç‚¹

1. **è½»é‡çº§**ï¼šæ— å¤–éƒ¨ä¾èµ–ï¼Œéƒ¨ç½²ç®€å•
2. **é«˜æ€§èƒ½**ï¼šå†…å­˜æ£€ç´¢ï¼Œå“åº”é€Ÿåº¦å¿«
3. **ç¦»çº¿è¿è¡Œ**ï¼šä¸ä¾èµ–å¤–éƒ¨æœåŠ¡
4. **æ˜“ç»´æŠ¤**ï¼šä»£ç ç»“æ„ç®€å•ï¼Œæ˜“äºç†è§£å’Œä¿®æ”¹
5. **èµ„æºå ç”¨ä½**ï¼šå†…å­˜å’Œ CPU æ¶ˆè€—è¾ƒå°

### 1.5 ç¼ºç‚¹

1. **åŠŸèƒ½ç›¸å¯¹ç®€å•**ï¼šåªæä¾›åŸºç¡€çš„å‘é‡æ£€ç´¢
2. **æ— å¤§æ¨¡å‹æ”¯æŒ**ï¼šæ— æ³•è¿›è¡Œæ™ºèƒ½é—®ç­”
3. **è¯­ä¹‰ç†è§£æœ‰é™**ï¼šåŸºäºå‘é‡ç›¸ä¼¼åº¦ï¼Œè¯­ä¹‰ç†è§£èƒ½åŠ›æœ‰é™
4. **æ‰©å±•æ€§å—é™**ï¼šåŠŸèƒ½æ‰©å±•éœ€è¦å¤§é‡è‡ªå®šä¹‰å¼€å‘
5. **ç¼ºå°‘é«˜çº§ç‰¹æ€§**ï¼šæ— å¯¹è¯ã€ä¸Šä¸‹æ–‡ç†è§£ç­‰é«˜çº§åŠŸèƒ½

---

## ğŸš€ 2. å¢å¼ºçŸ¥è¯†æ£€ç´¢æœåŠ¡ (EnhancedKnowledgeSearchService)

### 2.1 å®ç°æ–¹å¼

- **å‘é‡å­˜å‚¨**ï¼šLangChain4j æ¡†æ¶çš„ `InMemoryEmbeddingStore`
- **å‘é‡åŒ–**ï¼šLangChain4j + AllMiniLmL6V2 æ¨¡å‹
- **æ£€ç´¢ç®—æ³•**ï¼šLangChain4j çš„è¯­ä¹‰æ£€ç´¢
- **å¤§æ¨¡å‹é›†æˆ**ï¼šOpenAI GPT-3.5-turbo

### 2.2 æ ¸å¿ƒåŠŸèƒ½

```java
// ä¸»è¦æ–¹æ³•
public KnowledgeSearchResponse searchKnowledgeWithLangChain(KnowledgeSearchRequest request)
public String askQuestionWithLLM(String question)
public int processKnowledgeContentForLangChain(int page, int size)
```

### 2.3 æŠ€æœ¯æ ˆ

- **æ¡†æ¶**ï¼šLangChain4j
- **å‘é‡åŒ–æ¨¡å‹**ï¼šAllMiniLmL6V2 + OpenAI Embedding
- **å¤§æ¨¡å‹**ï¼šOpenAI GPT-3.5-turbo
- **å‘é‡å­˜å‚¨**ï¼šLangChain4j å†…å­˜å­˜å‚¨

### 2.4 ä¼˜ç‚¹

1. **æ™ºèƒ½æ£€ç´¢**ï¼šåŸºäº LangChain4j çš„è¯­ä¹‰æ£€ç´¢èƒ½åŠ›
2. **å¤§æ¨¡å‹æ”¯æŒ**ï¼šé›†æˆ OpenAI GPT-3.5-turbo è¿›è¡Œæ™ºèƒ½é—®ç­”
3. **åŠŸèƒ½ä¸°å¯Œ**ï¼šæ”¯æŒå¯¹è¯ã€ä¸Šä¸‹æ–‡ç†è§£ç­‰é«˜çº§åŠŸèƒ½
4. **æ‰©å±•æ€§å¼º**ï¼šåŸºäºæˆç†Ÿæ¡†æ¶ï¼Œæ˜“äºæ‰©å±•æ–°åŠŸèƒ½
5. **æ™ºèƒ½åŒ–ç¨‹åº¦é«˜**ï¼šèƒ½å¤Ÿç†è§£å¤æ‚æŸ¥è¯¢æ„å›¾

### 2.5 ç¼ºç‚¹

1. **å¤–éƒ¨ä¾èµ–**ï¼šä¾èµ– OpenAI APIï¼Œéœ€è¦ç½‘ç»œè¿æ¥
2. **æˆæœ¬è¾ƒé«˜**ï¼šä½¿ç”¨ OpenAI API éœ€è¦ä»˜è´¹
3. **ç½‘ç»œè¦æ±‚**ï¼šéœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥
4. **èµ„æºæ¶ˆè€—å¤§**ï¼šå†…å­˜å’Œ CPU æ¶ˆè€—ç›¸å¯¹è¾ƒé«˜
5. **é…ç½®å¤æ‚**ï¼šéœ€è¦é…ç½® API å¯†é’¥ç­‰å‚æ•°

---

## ğŸ“Š 3. è¯¦ç»†å¯¹æ¯”è¡¨

| å¯¹æ¯”ç»´åº¦       | åŸºç¡€æ£€ç´¢æœåŠ¡   | å¢å¼ºæ£€ç´¢æœåŠ¡           |
| -------------- | -------------- | ---------------------- |
| **å‘é‡å­˜å‚¨**   | è‡ªç ” FAISS     | LangChain4j            |
| **å‘é‡åŒ–æ¨¡å‹** | AllMiniLmL6V2  | AllMiniLmL6V2 + OpenAI |
| **æ£€ç´¢ç®—æ³•**   | ä½™å¼¦ç›¸ä¼¼åº¦     | LangChain4j è¯­ä¹‰æ£€ç´¢   |
| **å¤§æ¨¡å‹æ”¯æŒ** | æ—              | OpenAI GPT-3.5-turbo   |
| **é—®ç­”åŠŸèƒ½**   | æ—              | æœ‰                     |
| **å¤–éƒ¨ä¾èµ–**   | æ—              | OpenAI API             |
| **ç½‘ç»œè¦æ±‚**   | æ—              | éœ€è¦                   |
| **æˆæœ¬**       | ä½             | é«˜                     |
| **æ€§èƒ½**       | å¿«             | ä¸­ç­‰                   |
| **åŠŸèƒ½ä¸°å¯Œåº¦** | åŸºç¡€           | ä¸°å¯Œ                   |
| **æ‰©å±•æ€§**     | æœ‰é™           | å¼º                     |
| **ç»´æŠ¤å¤æ‚åº¦** | ä½             | é«˜                     |
| **éƒ¨ç½²éš¾åº¦**   | ç®€å•           | ä¸­ç­‰                   |
| **é€‚ç”¨åœºæ™¯**   | ç¦»çº¿ã€ç®€å•æ£€ç´¢ | åœ¨çº¿ã€æ™ºèƒ½é—®ç­”         |

---

## ğŸ¯ 4. ä½¿ç”¨åœºæ™¯å»ºè®®

### 4.1 åŸºç¡€æ£€ç´¢æœåŠ¡é€‚ç”¨åœºæ™¯

- **ç¦»çº¿ç¯å¢ƒ**ï¼šæ— æ³•è¿æ¥å¤–éƒ¨æœåŠ¡çš„ç¯å¢ƒ
- **æˆæœ¬æ•æ„Ÿ**ï¼šå¯¹æˆæœ¬æœ‰ä¸¥æ ¼è¦æ±‚çš„é¡¹ç›®
- **ç®€å•æ£€ç´¢**ï¼šåªéœ€è¦åŸºç¡€å‘é‡æ£€ç´¢åŠŸèƒ½
- **å¿«é€ŸåŸå‹**ï¼šéœ€è¦å¿«é€Ÿæ­å»ºåŸå‹ç³»ç»Ÿ
- **èµ„æºå—é™**ï¼šæœåŠ¡å™¨èµ„æºæœ‰é™çš„ç¯å¢ƒ

### 4.2 å¢å¼ºæ£€ç´¢æœåŠ¡é€‚ç”¨åœºæ™¯

- **æ™ºèƒ½é—®ç­”**ï¼šéœ€è¦æ™ºèƒ½é—®ç­”åŠŸèƒ½çš„åœºæ™¯
- **å¤æ‚æ£€ç´¢**ï¼šéœ€è¦å¤æ‚è¯­ä¹‰æ£€ç´¢çš„åœºæ™¯
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šå¯¹åŠŸèƒ½è¦æ±‚è¾ƒé«˜çš„ç”Ÿäº§ç¯å¢ƒ
- **ç”¨æˆ·ä½“éªŒ**ï¼šæ³¨é‡ç”¨æˆ·ä½“éªŒçš„åº”ç”¨
- **å¤§æ¨¡å‹é›†æˆ**ï¼šéœ€è¦å¤§æ¨¡å‹èƒ½åŠ›çš„é¡¹ç›®

---

## ğŸ—ï¸ 5. æŠ€æœ¯æ¶æ„å›¾

### 5.1 åŸºç¡€æ£€ç´¢æœåŠ¡æ¶æ„

```mermaid
graph TB
    A[ç”¨æˆ·æŸ¥è¯¢] --> B[VectorizationService]
    B --> C[FaissVectorStore]
    C --> D[ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—]
    D --> E[ç»“æœè¿‡æ»¤]
    E --> F[è¿”å›ç»“æœ]

    subgraph "å­˜å‚¨å±‚"
        G[å†…å­˜Map]
        H[æ–‡ä»¶æŒä¹…åŒ–]
    end

    C --> G
    C --> H
```

### 5.2 å¢å¼ºæ£€ç´¢æœåŠ¡æ¶æ„

```mermaid
graph TB
    A[ç”¨æˆ·æŸ¥è¯¢] --> B[LangChainService]
    B --> C[InMemoryEmbeddingStore]
    C --> D[è¯­ä¹‰æ£€ç´¢]
    D --> E[OpenAI GPT-3.5]
    E --> F[æ™ºèƒ½é—®ç­”ç»“æœ]

    subgraph "å¤–éƒ¨æœåŠ¡"
        G[OpenAI API]
        H[Embedding Model]
    end

    E --> G
    B --> H
```

---

## ğŸ”§ 6. ä»£ç ç¤ºä¾‹

### 6.1 åŸºç¡€æ£€ç´¢æœåŠ¡ä½¿ç”¨ç¤ºä¾‹

```java
@RestController
@RequestMapping("/api/knowledge")
public class KnowledgeSearchController {

    @PostMapping("/search")
    public ResponseEntity<Map<String, Object>> searchKnowledge(
            @RequestBody KnowledgeSearchRequest request) {

        KnowledgeSearchResponse response = knowledgeSearchService.searchKnowledge(request);

        Map<String, Object> result = new HashMap<>();
        result.put("success", true);
        result.put("data", response);
        result.put("message", "æ£€ç´¢æˆåŠŸ");

        return ResponseEntity.ok(result);
    }
}
```

### 6.2 å¢å¼ºæ£€ç´¢æœåŠ¡ä½¿ç”¨ç¤ºä¾‹

```java
@RestController
@RequestMapping("/api/enhanced-knowledge")
public class EnhancedKnowledgeSearchController {

    @PostMapping("/search")
    public ResponseEntity<Map<String, Object>> searchWithLangChain(
            @RequestBody KnowledgeSearchRequest request) {

        KnowledgeSearchResponse response =
            enhancedKnowledgeSearchService.searchKnowledgeWithLangChain(request);

        Map<String, Object> result = new HashMap<>();
        result.put("success", true);
        result.put("data", response);
        result.put("message", "LangChainæ£€ç´¢æˆåŠŸ");

        return ResponseEntity.ok(result);
    }

    @PostMapping("/ask")
    public ResponseEntity<Map<String, Object>> askWithLLM(
            @RequestBody Map<String, String> request) {

        String question = request.get("question");
        String answer = enhancedKnowledgeSearchService.askQuestionWithLLM(question);

        Map<String, Object> result = new HashMap<>();
        result.put("success", true);
        result.put("answer", answer);
        result.put("message", "é—®ç­”æˆåŠŸ");

        return ResponseEntity.ok(result);
    }
}
```

---

## ğŸ“ˆ 7. æ€§èƒ½å¯¹æ¯”

### 7.1 å“åº”æ—¶é—´

- **åŸºç¡€æ£€ç´¢æœåŠ¡**ï¼šå¹³å‡å“åº”æ—¶é—´ < 100ms
- **å¢å¼ºæ£€ç´¢æœåŠ¡**ï¼šå¹³å‡å“åº”æ—¶é—´ 500-2000ms

### 7.2 å†…å­˜å ç”¨

- **åŸºç¡€æ£€ç´¢æœåŠ¡**ï¼šçº¦ 50-100MB
- **å¢å¼ºæ£€ç´¢æœåŠ¡**ï¼šçº¦ 200-500MB

### 7.3 å¹¶å‘å¤„ç†èƒ½åŠ›

- **åŸºç¡€æ£€ç´¢æœåŠ¡**ï¼šæ”¯æŒé«˜å¹¶å‘ï¼Œæ— å¤–éƒ¨ä¾èµ–é™åˆ¶
- **å¢å¼ºæ£€ç´¢æœåŠ¡**ï¼šå— OpenAI API é™åˆ¶ï¼Œå¹¶å‘èƒ½åŠ›æœ‰é™

---

## ğŸ› ï¸ 8. éƒ¨ç½²å’Œé…ç½®

### 8.1 åŸºç¡€æ£€ç´¢æœåŠ¡é…ç½®

```properties
# å‘é‡åŒ–é…ç½®
vectorization.dimension=384
vectorization.batch-size=100

# å‘é‡å­˜å‚¨é…ç½®
vector.auto-load.enabled=true
vector.auto-load.page-size=100
```

### 8.2 å¢å¼ºæ£€ç´¢æœåŠ¡é…ç½®

```properties
# LangChain4jé…ç½®
langchain.openai.api-key=${OPENAI_API_KEY:}
langchain.openai.model=gpt-3.5-turbo
langchain.embedding.model=all-minilm-l6-v2

# å‘é‡æ•°æ®è‡ªåŠ¨åŠ è½½é…ç½®
vector.auto-load.enabled=true
vector.auto-load.page-size=100
```

---

## ğŸ¯ 9. é€‰æ‹©å»ºè®®

### 9.1 é€‰æ‹©åŸºç¡€æ£€ç´¢æœåŠ¡çš„æƒ…å†µ

- é¡¹ç›®é¢„ç®—æœ‰é™
- éœ€è¦ç¦»çº¿éƒ¨ç½²
- åªéœ€è¦åŸºç¡€æ£€ç´¢åŠŸèƒ½
- å¯¹å“åº”æ—¶é—´è¦æ±‚æé«˜
- æœåŠ¡å™¨èµ„æºæœ‰é™

### 9.2 é€‰æ‹©å¢å¼ºæ£€ç´¢æœåŠ¡çš„æƒ…å†µ

- éœ€è¦æ™ºèƒ½é—®ç­”åŠŸèƒ½
- å¯¹ç”¨æˆ·ä½“éªŒè¦æ±‚è¾ƒé«˜
- æœ‰è¶³å¤Ÿçš„é¢„ç®—æ”¯æŒ API è°ƒç”¨
- éœ€è¦å¤æ‚çš„è¯­ä¹‰ç†è§£
- è®¡åˆ’æ‰©å±•æ›´å¤š AI åŠŸèƒ½

---

## ğŸ”® 10. æœªæ¥å‘å±•æ–¹å‘

### 10.1 åŸºç¡€æ£€ç´¢æœåŠ¡

- ä¼˜åŒ–å‘é‡åŒ–ç®—æ³•
- å¢åŠ æ›´å¤šè¿‡æ»¤æ¡ä»¶
- æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²
- é›†æˆæ›´å¤šå‘é‡åŒ–æ¨¡å‹

### 10.2 å¢å¼ºæ£€ç´¢æœåŠ¡

- æ”¯æŒæ›´å¤šå¤§æ¨¡å‹æä¾›å•†
- å¢åŠ æœ¬åœ°å¤§æ¨¡å‹æ”¯æŒ
- ä¼˜åŒ–æ£€ç´¢ç®—æ³•
- å¢åŠ å¯¹è¯å†å²ç®¡ç†

---

## ğŸ“ 11. æ€»ç»“

LangChain å·¥ç¨‹ä¸­çš„ä¸¤ç§çŸ¥è¯†æ£€ç´¢å®ç°æ–¹å¼å„æœ‰ä¼˜åŠ¿ï¼š

- **åŸºç¡€æ£€ç´¢æœåŠ¡**ï¼šé€‚åˆå¯¹æ€§èƒ½ã€æˆæœ¬å’Œéƒ¨ç½²ç®€å•æ€§æœ‰è¦æ±‚çš„åœºæ™¯ï¼Œæä¾›å¿«é€Ÿã€ç¨³å®šçš„å‘é‡æ£€ç´¢åŠŸèƒ½ã€‚

- **å¢å¼ºæ£€ç´¢æœåŠ¡**ï¼šé€‚åˆå¯¹æ™ºèƒ½åŒ–ç¨‹åº¦å’Œç”¨æˆ·ä½“éªŒæœ‰è¦æ±‚çš„åœºæ™¯ï¼Œæä¾›ä¸°å¯Œçš„ AI åŠŸèƒ½å’Œæ™ºèƒ½é—®ç­”èƒ½åŠ›ã€‚

æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚ã€æŠ€æœ¯è¦æ±‚å’Œèµ„æºé™åˆ¶ï¼Œå¯ä»¥é€‰æ‹©åˆé€‚çš„å®ç°æ–¹å¼ï¼Œæˆ–è€…ç»„åˆä½¿ç”¨ä¸¤ç§æ–¹å¼ä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚åœºæ™¯ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2025 å¹´ 9 æœˆ 30 æ—¥  
**ç»´æŠ¤å›¢é˜Ÿ**ï¼šHA72 å¼€å‘å›¢é˜Ÿ
