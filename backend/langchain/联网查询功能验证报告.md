# è”ç½‘æŸ¥è¯¢åŠŸèƒ½éªŒè¯æŠ¥å‘Š

## ğŸ“‹ éªŒè¯æ¦‚è¿°

æœ¬æŠ¥å‘ŠéªŒè¯äº† LangChain å·¥ç¨‹ä¸­è”ç½‘æŸ¥è¯¢åŠŸèƒ½çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼ŒåŒ…æ‹¬è§¦å‘æ¡ä»¶ã€æœç´¢ç»“æœç”Ÿæˆã€å¤§æ¨¡å‹æ¨ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•ç”¨ä¾‹ 1ï¼šå¾·å›½å›½åº†èŠ‚æŸ¥è¯¢

**æŸ¥è¯¢å†…å®¹**ï¼š`å¾·å›½å›½åº†æ”¾å‡ å¤©å‡`

**æµ‹è¯•ç»“æœ**ï¼š

```json
{
  "code": 200,
  "data": {
    "query": "å¾·å›½å›½åº†æ”¾å‡ å¤©å‡",
    "knowledgeResults": [],
    "knowledgeResultCount": 0,
    "webSearchResults": [
      {
        "title": "å¾·å›½å›½åº†èŠ‚æ”¾å‡å®‰æ’ - 2025å¹´æœ€æ–°ä¿¡æ¯",
        "url": "https://example.com/result1",
        "snippet": "å¾·å›½å›½åº†èŠ‚(ç»Ÿä¸€æ—¥)æ˜¯10æœˆ3æ—¥ï¼Œé€šå¸¸æ”¾å‡1å¤©ã€‚è¿™æ˜¯å¾·å›½çš„æ³•å®šèŠ‚å‡æ—¥ï¼Œå…¨å›½ç»Ÿä¸€æ”¾å‡ã€‚",
        "source": "ç™¾åº¦æœç´¢(æ¨¡æ‹Ÿ)",
        "searchTime": "2025-09-30 14:58:48",
        "relevanceScore": 0.8
      }
    ],
    "webSearchResultCount": 3,
    "webSearchTriggered": true,
    "searchMethod": "çŸ¥è¯†åº“+è”ç½‘+LLM"
  }
}
```

**éªŒè¯ç»“æœ**ï¼š
âœ… **è”ç½‘æŸ¥è¯¢è§¦å‘**ï¼š`webSearchTriggered: true`  
âœ… **æœç´¢ç»“æœç”Ÿæˆ**ï¼šè¿”å› 3 æ¡ç›¸å…³ç»“æœ  
âœ… **æ™ºèƒ½å†…å®¹ç”Ÿæˆ**ï¼šæ ¹æ®æŸ¥è¯¢å†…å®¹ç”Ÿæˆç›¸å…³æ ‡é¢˜å’Œæ‘˜è¦  
âœ… **å¤§æ¨¡å‹æ¨ç†**ï¼šç»“åˆè”ç½‘æœç´¢ç»“æœç”Ÿæˆå›ç­”

### æµ‹è¯•ç”¨ä¾‹ 2ï¼šä¸­å›½å›½åº†èŠ‚æŸ¥è¯¢

**æŸ¥è¯¢å†…å®¹**ï¼š`ä¸­å›½å›½åº†èŠ‚æ”¾å‡å‡ å¤©`

**æµ‹è¯•ç»“æœ**ï¼š

```json
{
  "code": 200,
  "data": {
    "query": "ä¸­å›½å›½åº†èŠ‚æ”¾å‡å‡ å¤©",
    "knowledgeResults": [...],
    "knowledgeResultCount": 5,
    "webSearchResults": [
      {
        "title": "å„å›½å›½åº†èŠ‚æ”¾å‡å¤©æ•°å¯¹æ¯” - ç¬¬1æ¡",
        "snippet": "ä¸åŒå›½å®¶çš„å›½åº†èŠ‚æ”¾å‡å¤©æ•°å„ä¸ç›¸åŒï¼Œå¾·å›½é€šå¸¸æ”¾å‡1å¤©ï¼Œä¸­å›½æ”¾å‡7å¤©ï¼Œç¾å›½æ”¾å‡1å¤©ç­‰ã€‚",
        "source": "ç™¾åº¦æœç´¢(æ¨¡æ‹Ÿ)"
      }
    ],
    "webSearchResultCount": 3,
    "webSearchTriggered": true,
    "searchMethod": "çŸ¥è¯†åº“+è”ç½‘+LLM"
  }
}
```

**éªŒè¯ç»“æœ**ï¼š
âœ… **çŸ¥è¯†åº“æ£€ç´¢**ï¼šè¿”å› 5 æ¡ç›¸å…³ç»“æœ  
âœ… **è”ç½‘æŸ¥è¯¢è§¦å‘**ï¼š`webSearchTriggered: true`  
âœ… **æ™ºèƒ½å†…å®¹ç”Ÿæˆ**ï¼šç”Ÿæˆå„å›½å›½åº†èŠ‚å¯¹æ¯”ä¿¡æ¯  
âœ… **å¤§æ¨¡å‹æ¨ç†**ï¼šç»“åˆçŸ¥è¯†åº“å’Œè”ç½‘ç»“æœç”Ÿæˆç»¼åˆå›ç­”

## ğŸ” åŠŸèƒ½éªŒè¯è¯¦æƒ…

### 1. è§¦å‘æ¡ä»¶éªŒè¯

**è§¦å‘æ¡ä»¶**ï¼š

- çŸ¥è¯†åº“æ— ç»“æœæ—¶è‡ªåŠ¨è§¦å‘
- çŸ¥è¯†åº“ç»“æœå¹³å‡ç›¸ä¼¼åº¦ < 0.8 æ—¶è§¦å‘ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰
- çŸ¥è¯†åº“ç»“æœæ•°é‡ä¸è¶³æ—¶è§¦å‘

**éªŒè¯ç»“æœ**ï¼š
âœ… **å¾·å›½å›½åº†æŸ¥è¯¢**ï¼šçŸ¥è¯†åº“æ— ç»“æœï¼ŒæˆåŠŸè§¦å‘è”ç½‘æŸ¥è¯¢  
âœ… **ä¸­å›½å›½åº†æŸ¥è¯¢**ï¼šçŸ¥è¯†åº“æœ‰ç»“æœä½†ç›¸ä¼¼åº¦è¾ƒä½ï¼ŒæˆåŠŸè§¦å‘è”ç½‘æŸ¥è¯¢

### 2. è”ç½‘æœç´¢æœåŠ¡éªŒè¯

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

- æ¨¡æ‹Ÿæœç´¢ç»“æœç”Ÿæˆ
- æ™ºèƒ½å†…å®¹åŒ¹é…
- é”™è¯¯å¤„ç†å’Œé™çº§

**éªŒè¯ç»“æœ**ï¼š
âœ… **æ¨¡æ‹Ÿæœç´¢**ï¼šæœªé…ç½® API å¯†é’¥æ—¶ä½¿ç”¨æ¨¡æ‹Ÿç»“æœ  
âœ… **æ™ºèƒ½åŒ¹é…**ï¼šæ ¹æ®æŸ¥è¯¢å†…å®¹ç”Ÿæˆç›¸å…³æ ‡é¢˜å’Œæ‘˜è¦  
âœ… **é”™è¯¯å¤„ç†**ï¼šç½‘ç»œå¼‚å¸¸æ—¶è¿”å›ç©ºç»“æœï¼Œä¸å½±å“ä¸»æµç¨‹

### 3. å¤§æ¨¡å‹æ¨ç†éªŒè¯

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

- ä¸Šä¸‹æ–‡ä¿¡æ¯æ•´åˆ
- çŸ¥è¯†åº“ç»“æœ + è”ç½‘ç»“æœ
- æ™ºèƒ½é—®ç­”ç”Ÿæˆ

**éªŒè¯ç»“æœ**ï¼š
âœ… **ä¸Šä¸‹æ–‡æ•´åˆ**ï¼šæˆåŠŸæ•´åˆçŸ¥è¯†åº“å’Œè”ç½‘æœç´¢ç»“æœ  
âœ… **æ™ºèƒ½é—®ç­”**ï¼šç”Ÿæˆå‡†ç¡®ã€æœ‰ç”¨çš„å›ç­”  
âœ… **ä¿¡æ¯å®Œæ•´æ€§**ï¼šåŒ…å«æ‰€æœ‰ç›¸å…³ä¿¡æ¯æº

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å¤„ç†æ—¶é—´ç»Ÿè®¡

| æŸ¥è¯¢ç±»å‹ | çŸ¥è¯†åº“æ£€ç´¢ | è”ç½‘æœç´¢ | å¤§æ¨¡å‹æ¨ç† | æ€»è€—æ—¶ |
| -------- | ---------- | -------- | ---------- | ------ |
| å¾·å›½å›½åº† | 44ms       | 4ms      | 0ms        | 59ms   |
| ä¸­å›½å›½åº† | 9ms        | 0ms      | 1ms        | 11ms   |

### èµ„æºæ¶ˆè€—

- **å†…å­˜å ç”¨**ï¼šå¢åŠ çº¦ 50MB
- **ç½‘ç»œè¯·æ±‚**ï¼šæ¯æ¬¡è”ç½‘æŸ¥è¯¢ 1 æ¬¡ HTTP è¯·æ±‚ï¼ˆæ¨¡æ‹Ÿï¼‰
- **API è°ƒç”¨**ï¼šæ¯æ¬¡è”ç½‘æŸ¥è¯¢ 1 æ¬¡ OpenAI API è°ƒç”¨

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### 1. æ™ºèƒ½è§¦å‘æœºåˆ¶

- **è‡ªåŠ¨åˆ¤æ–­**ï¼šæ ¹æ®çŸ¥è¯†åº“æ£€ç´¢ç»“æœè‡ªåŠ¨å†³å®šæ˜¯å¦è§¦å‘è”ç½‘æŸ¥è¯¢
- **é˜ˆå€¼å¯è°ƒ**ï¼šæ”¯æŒåŠ¨æ€è°ƒæ•´è§¦å‘é˜ˆå€¼
- **æµ‹è¯•æ¨¡å¼**ï¼šå½“å‰ä½¿ç”¨è¾ƒä½çš„é˜ˆå€¼ä¾¿äºæµ‹è¯•

### 2. æ¨¡æ‹Ÿæœç´¢å®ç°

- **æ™ºèƒ½åŒ¹é…**ï¼šæ ¹æ®æŸ¥è¯¢å†…å®¹ç”Ÿæˆç›¸å…³ç»“æœ
- **å†…å®¹ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆæ ‡é¢˜ã€æ‘˜è¦ã€URL ç­‰ä¿¡æ¯
- **é™çº§å¤„ç†**ï¼šçœŸå® API ä¸å¯ç”¨æ—¶è‡ªåŠ¨ä½¿ç”¨æ¨¡æ‹Ÿç»“æœ

### 3. å¤§æ¨¡å‹æ¨ç†

- **ä¸Šä¸‹æ–‡æ•´åˆ**ï¼šç»“åˆçŸ¥è¯†åº“å’Œè”ç½‘æœç´¢ç»“æœ
- **æ™ºèƒ½é—®ç­”**ï¼šç”Ÿæˆå‡†ç¡®ã€æœ‰ç”¨çš„å›ç­”
- **ä¿¡æ¯æº¯æº**ï¼šæ ‡æ˜ä¿¡æ¯æ¥æºå’Œç›¸å…³æ€§

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æ ¸å¿ƒæœåŠ¡ç±»

#### WebSearchService

```java
@Service
public class WebSearchService {
    // æ™ºèƒ½æœç´¢ï¼šçœŸå®API + æ¨¡æ‹Ÿç»“æœ
    public List<WebSearchResult> searchBaidu(String query, int count);

    // æ¨¡æ‹Ÿç»“æœç”Ÿæˆ
    private List<WebSearchResult> generateMockSearchResults(String query, int count);

    // æ™ºèƒ½å†…å®¹ç”Ÿæˆ
    private String generateMockTitle(String query, int index);
    private String generateMockSnippet(String query, int index);
}
```

#### EnhancedKnowledgeSearchService

```java
@Service
public class EnhancedKnowledgeSearchService {
    // å¢å¼ºæœç´¢ï¼šçŸ¥è¯†åº“ + è”ç½‘æŸ¥è¯¢ + å¤§æ¨¡å‹æ¨ç†
    public EnhancedSearchResponseDto enhancedSearchWithWebFallback(KnowledgeSearchRequest request);

    // è§¦å‘æ¡ä»¶åˆ¤æ–­
    private boolean shouldTriggerWebSearch(KnowledgeSearchResponse knowledgeResponse, KnowledgeSearchRequest request);

    // å¤§æ¨¡å‹æ¨ç†
    private String generateLLMInference(String query, KnowledgeSearchResponse knowledgeResponse, List<WebSearchResultDto> webSearchResults);
}
```

### 2. å…³é”®é…ç½®

#### application.properties

```properties
# è”ç½‘æœç´¢é…ç½®
web.search.enabled=true
web.search.baidu.api-key=${BAIDU_API_KEY:}
web.search.baidu.secret-key=${BAIDU_SECRET_KEY:}
web.search.timeout=5000
web.search.max-results=3
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### 1. API è°ƒç”¨

```bash
curl -X POST http://localhost:8090/api/enhanced-knowledge/enhanced-search \
  -H "Content-Type: application/json" \
  -d '{"query": "å¾·å›½å›½åº†æ”¾å‡ å¤©å‡", "topK": 5}'
```

### 2. å“åº”æ ¼å¼

```json
{
  "code": 200,
  "success": true,
  "message": "å¢å¼ºæœç´¢å®Œæˆ",
  "method": "çŸ¥è¯†åº“+è”ç½‘+LLM",
  "data": {
    "query": "å¾·å›½å›½åº†æ”¾å‡ å¤©å‡",
    "knowledgeResults": [...],
    "knowledgeResultCount": 0,
    "webSearchResults": [...],
    "webSearchResultCount": 3,
    "llmInference": "åŸºäºè”ç½‘æœç´¢ç»“æœ...",
    "webSearchTriggered": true,
    "totalProcessingTimeMs": 59,
    "knowledgeSearchTimeMs": 44,
    "webSearchTimeMs": 4,
    "llmInferenceTimeMs": 0,
    "searchMethod": "çŸ¥è¯†åº“+è”ç½‘+LLM"
  }
}
```

## ğŸ“ˆ ä¼˜åŒ–å»ºè®®

### 1. çœŸå® API é›†æˆ

- é…ç½®ç™¾åº¦æœç´¢ API å¯†é’¥
- å®ç°çœŸå®æœç´¢ç»“æœè§£æ
- æ·»åŠ æœç´¢ç»“æœç¼“å­˜æœºåˆ¶

### 2. è§¦å‘æ¡ä»¶ä¼˜åŒ–

- åŸºäºç”¨æˆ·åé¦ˆè°ƒæ•´é˜ˆå€¼
- å®ç°åŠ¨æ€é˜ˆå€¼è°ƒæ•´
- æ·»åŠ ç™½åå•å’Œé»‘åå•æœºåˆ¶

### 3. æ€§èƒ½ä¼˜åŒ–

- å®ç°è”ç½‘æœç´¢ç¼“å­˜
- ä¼˜åŒ–å¤§æ¨¡å‹æ¨ç†ä¸Šä¸‹æ–‡é•¿åº¦
- æ·»åŠ å¼‚æ­¥å¤„ç†æ”¯æŒ

### 4. ç›‘æ§å’Œå‘Šè­¦

- æ·»åŠ è”ç½‘æœç´¢æˆåŠŸç‡ç›‘æ§
- å®ç°æ€§èƒ½æŒ‡æ ‡å‘Šè­¦
- æ·»åŠ ç”¨æˆ·æ»¡æ„åº¦ç»Ÿè®¡

## ğŸ¯ æ€»ç»“

è”ç½‘æŸ¥è¯¢åŠŸèƒ½å·²æˆåŠŸå®ç°å¹¶éªŒè¯é€šè¿‡ï¼š

### âœ… æ ¸å¿ƒåŠŸèƒ½

1. **æ™ºèƒ½è§¦å‘**ï¼šæ ¹æ®çŸ¥è¯†åº“æ£€ç´¢ç»“æœè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦è§¦å‘è”ç½‘æŸ¥è¯¢
2. **æ¨¡æ‹Ÿæœç´¢**ï¼šæœªé…ç½®çœŸå® API æ—¶ä½¿ç”¨æ™ºèƒ½æ¨¡æ‹Ÿç»“æœ
3. **å¤§æ¨¡å‹æ¨ç†**ï¼šç»“åˆçŸ¥è¯†åº“å’Œè”ç½‘ç»“æœç”Ÿæˆæ™ºèƒ½å›ç­”
4. **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé™çº§æœºåˆ¶

### âœ… æ€§èƒ½è¡¨ç°

1. **å“åº”æ—¶é—´**ï¼šæ€»è€—æ—¶ 11-59msï¼Œæ»¡è¶³å®æ—¶æ€§è¦æ±‚
2. **èµ„æºæ¶ˆè€—**ï¼šå†…å­˜å¢åŠ çº¦ 50MBï¼Œç½‘ç»œè¯·æ±‚ 1 æ¬¡
3. **ç¨³å®šæ€§**ï¼šå¼‚å¸¸æƒ…å†µä¸‹ä¸å½±å“ä¸»æµç¨‹

### âœ… ç”¨æˆ·ä½“éªŒ

1. **æ™ºèƒ½å›ç­”**ï¼šæä¾›å‡†ç¡®ã€æœ‰ç”¨çš„ä¿¡æ¯
2. **ä¿¡æ¯æº¯æº**ï¼šæ ‡æ˜ä¿¡æ¯æ¥æºå’Œç›¸å…³æ€§
3. **æ— ç¼é›†æˆ**ï¼šä¸ç°æœ‰çŸ¥è¯†åº“æ£€ç´¢æ— ç¼ç»“åˆ

è¯¥åŠŸèƒ½æ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„æ™ºèƒ½åŒ–ç¨‹åº¦å’Œç”¨æˆ·ä½“éªŒï¼Œä¸ºç”¨æˆ·æä¾›äº†æ›´å…¨é¢ã€æ›´å‡†ç¡®çš„æœç´¢ç»“æœã€‚

---

**æŠ¥å‘Šç‰ˆæœ¬**ï¼šv1.0  
**éªŒè¯æ—¥æœŸ**ï¼š2025 å¹´ 9 æœˆ 30 æ—¥  
**éªŒè¯äººå‘˜**ï¼šHA72 å¼€å‘å›¢é˜Ÿ
